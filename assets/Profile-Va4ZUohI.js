import{u as O,g as Y,r as i,j as e}from"./index-Ddy5vbIH.js";const J=()=>{const{user:r,login:I}=O(),{points:z,badges:C,history:k}=Y(),[y,f]=i.useState(!1),[o,v]=i.useState({name:"",address:"",city:"",zip:"",country:"",avatar:""}),[g,u]=i.useState(""),[A,T]=i.useState([]),[b,D]=i.useState(!1),[B,N]=i.useState([]),[E,U]=i.useState(1),[n,c]=i.useState({name:"",address:"",city:"",zip:"",country:""});i.useEffect(()=>{r&&(v({name:r.name||"",address:r.address||"",city:r.city||"",zip:r.zip||"",country:r.country||"",avatar:r.avatar||""}),P(r.id),j(r.id))},[r]);const j=async t=>{try{const a=await(await fetch(`https://techorbit-api.onrender.com/api/addresses/${t}`)).json();a.message==="success"&&T(a.data)}catch(s){console.error("Failed to fetch addresses",s)}},M=async t=>{t.preventDefault();try{(await(await fetch("https://techorbit-api.onrender.com/api/addresses",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...n,user_id:r.id})})).json()).message==="success"&&(u("Address added!"),D(!1),c({name:"",address:"",city:"",zip:"",country:""}),j(r.id))}catch(s){console.error(s)}},$=async t=>{if(confirm("Delete this address?"))try{await fetch(`https://techorbit-api.onrender.com/api/addresses/${t}`,{method:"DELETE"}),j(r.id)}catch(s){console.error(s)}},P=async t=>{try{const a=await(await fetch(`https://techorbit-api.onrender.com/api/orders/user/${t}`)).json();if(a.message==="success"){const p=a.data,h=new Array(6).fill(0),S=[],x=new Date;for(let l=5;l>=0;l--){const m=new Date(x.getFullYear(),x.getMonth()-l,1);S.push(m.toLocaleString("default",{month:"short"}))}p.forEach(l=>{const m=new Date(l.date||l.created_at),w=(x.getFullYear()-m.getFullYear())*12+(x.getMonth()-m.getMonth());w>=0&&w<6&&(h[5-w]+=l.total)}),N(h);const q=Math.max(...h,1);U(q)}}catch(s){console.error("Failed to fetch spending data",s),N([0,0,0,0,0,0])}},F=t=>{v({...o,[t.target.name]:t.target.value})},W=t=>{const s=t.target.files[0];if(s){const d=new FileReader;d.onloadend=()=>{const a=new Image;a.src=d.result,a.onload=()=>{const p=document.createElement("canvas"),h=p.getContext("2d");p.width=100,p.height=100,h.drawImage(a,0,0,100,100);const S=p.toDataURL("image/jpeg",.8);v(x=>({...x,avatar:S}))}},d.readAsDataURL(s)}},L=async t=>{t.preventDefault();try{const a=await(await fetch(`https://techorbit-api.onrender.com/api/users/${r.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)})).json();a.message==="updated"?(u("Profile updated successfully!"),f(!1),I({...r,...o})):u("Error: "+a.error)}catch(s){u("Error: "+s.message)}};if(!r)return e.jsx("div",{className:"container",style:{padding:"40px"},children:"Please login."});const R=B.map((t,s)=>`${s*100},${150-t/E*120}`).join(" ");return e.jsx("div",{className:"container",style:{paddingBottom:"50px"},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 2fr",gap:"30px",alignItems:"start"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"30px"},children:[e.jsxs("div",{className:"card",style:{padding:"25px",background:"linear-gradient(135deg, #0f172a 0%, #1e293b 100%)",color:"white",border:"none"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsx("h3",{style:{fontSize:"18px",margin:0},children:"TechCoins Balance"}),e.jsx("span",{style:{fontSize:"24px"},children:"ðŸª™"})]}),e.jsx("div",{style:{fontSize:"42px",fontWeight:"800",margin:"15px 0"},children:z}),e.jsxs("div",{style:{fontSize:"13px",opacity:.8},children:["worth $",(z/10).toFixed(2)," in discounts"]}),e.jsxs("div",{style:{marginTop:"20px"},children:[e.jsx("div",{style:{fontSize:"12px",fontWeight:"600",marginBottom:"8px",textTransform:"uppercase",opacity:.7},children:"Earned Badges"}),e.jsxs("div",{style:{display:"flex",gap:"10px",flexWrap:"wrap"},children:[C.map(t=>e.jsxs("span",{style:{background:"rgba(255,255,255,0.15)",padding:"5px 12px",borderRadius:"15px",fontSize:"11px",border:"1px solid rgba(255,255,255,0.3)"},children:["ðŸ† ",t]},t)),C.length===0&&e.jsx("span",{style:{fontSize:"12px",fontStyle:"italic",opacity:.5},children:"No badges yet"})]})]})]}),e.jsxs("div",{className:"card",style:{padding:"30px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px",borderBottom:"1px solid #eee",paddingBottom:"10px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"20px"},children:[e.jsxs("div",{style:{position:"relative",width:"80px",height:"80px"},children:[e.jsx("div",{style:{width:"100%",height:"100%",borderRadius:"50%",background:"var(--primary)",color:"white",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"32px",fontWeight:"bold",overflow:"hidden",border:"3px solid var(--surface)"},children:o.avatar?e.jsx("img",{src:o.avatar,alt:"Profile",style:{width:"100%",height:"100%",objectFit:"cover"}}):r.name?.charAt(0)}),y&&e.jsxs("label",{style:{position:"absolute",bottom:"-5px",right:"-5px",background:"var(--text-main)",color:"var(--surface)",width:"30px",height:"30px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",border:"2px solid var(--surface)",boxShadow:"var(--shadow-sm)"},title:"Change Photo",children:["ðŸ“·",e.jsx("input",{type:"file",accept:"image/*",onChange:W,style:{display:"none"}})]})]}),e.jsxs("div",{children:[e.jsx("h2",{style:{fontSize:"24px",margin:0,color:"var(--text-main)"},children:o.name}),e.jsx("p",{style:{margin:"5px 0 0",color:"var(--text-secondary)",fontSize:"14px"},children:r.email})]})]}),y?e.jsx("button",{onClick:()=>f(!1),style:{background:"none",border:"none",cursor:"pointer",fontSize:"18px",color:"var(--text-secondary)"},title:"Cancel",children:"âœ•"}):e.jsx("button",{onClick:()=>f(!0),style:{background:"none",border:"none",cursor:"pointer",fontSize:"18px"},title:"Edit Profile",children:"âœï¸"})]}),g&&e.jsx("div",{style:{padding:"10px",background:g.includes("Error")?"#ffebee":"#e8f5e9",color:g.includes("Error")?"#c62828":"#2e7d32",marginBottom:"20px",borderRadius:"4px",fontSize:"14px"},children:g}),e.jsxs("form",{onSubmit:L,style:{display:"grid",gap:"15px"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"5px",fontWeight:"500",fontSize:"14px",color:"var(--text-secondary)"},children:"Name"}),y?e.jsx("input",{name:"name",value:o.name,onChange:F,required:!0,style:{width:"100%",padding:"10px",borderRadius:"8px",border:"1px solid var(--border)",background:"var(--surface-hover)",color:"var(--text-main)"}}):e.jsx("div",{style:{padding:"10px",fontWeight:"600",color:"var(--text-main)"},children:o.name})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",marginBottom:"5px",fontWeight:"500",fontSize:"14px",color:"var(--text-secondary)"},children:"Email"}),e.jsx("div",{style:{padding:"10px",background:"var(--surface-hover)",borderRadius:"8px",color:"var(--text-secondary)",border:"1px solid var(--border)"},children:r.email})]}),y&&e.jsx("div",{style:{marginTop:"10px",textAlign:"right"},children:e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Save Profile Info"})})]}),e.jsxs("div",{style:{marginTop:"40px",paddingTop:"30px",borderTop:"1px solid var(--border)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsx("h3",{style:{fontSize:"18px",margin:0,color:"var(--text-main)"},children:"Address Book"}),e.jsx("button",{onClick:()=>D(!b),className:"btn btn-secondary",style:{fontSize:"12px",padding:"6px 12px"},children:b?"Cancel":"+ Add New"})]}),b&&e.jsx("form",{onSubmit:M,style:{background:"var(--surface-hover)",padding:"20px",borderRadius:"12px",marginBottom:"20px"},children:e.jsxs("div",{style:{display:"grid",gap:"10px"},children:[e.jsx("input",{placeholder:"Location Name (e.g. Home, Office)",value:n.name,onChange:t=>c({...n,name:t.target.value}),required:!0,style:{padding:"10px",borderRadius:"8px",border:"1px solid var(--border)"}}),e.jsx("input",{placeholder:"Address Line",value:n.address,onChange:t=>c({...n,address:t.target.value}),required:!0,style:{padding:"10px",borderRadius:"8px",border:"1px solid var(--border)"}}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px"},children:[e.jsx("input",{placeholder:"City",value:n.city,onChange:t=>c({...n,city:t.target.value}),required:!0,style:{padding:"10px",borderRadius:"8px",border:"1px solid var(--border)"}}),e.jsx("input",{placeholder:"ZIP Code",value:n.zip,onChange:t=>c({...n,zip:t.target.value}),required:!0,style:{padding:"10px",borderRadius:"8px",border:"1px solid var(--border)"}})]}),e.jsx("input",{placeholder:"Country",value:n.country,onChange:t=>c({...n,country:t.target.value}),required:!0,style:{padding:"10px",borderRadius:"8px",border:"1px solid var(--border)"}}),e.jsx("button",{type:"submit",className:"btn btn-primary",style:{marginTop:"10px"},children:"Save Address"})]})}),e.jsxs("div",{style:{display:"grid",gap:"15px"},children:[A.map(t=>e.jsxs("div",{style:{padding:"15px",border:"1px solid var(--border)",borderRadius:"12px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:"bold",fontSize:"14px",color:"var(--text-main)"},children:t.name}),e.jsxs("div",{style:{fontSize:"13px",color:"var(--text-secondary)"},children:[t.address,", ",t.city," ",t.zip,", ",t.country]})]}),e.jsx("button",{onClick:()=>$(t.id),style:{color:"var(--error)",background:"none",border:"none",cursor:"pointer"},children:"ðŸ—‘ï¸"})]},t.id)),A.length===0&&e.jsx("p",{style:{color:"var(--text-secondary)",fontStyle:"italic",fontSize:"13px"},children:"No saved addresses."})]})]})]})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"30px"},children:[e.jsxs("div",{className:"card",style:{padding:"30px"},children:[e.jsx("h3",{style:{fontSize:"18px",marginBottom:"20px",color:"var(--text-main)"},children:"Spending Insights (Last 6 Months)"}),e.jsx("div",{style:{width:"100%",height:"200px",display:"flex",alignItems:"flex-end",position:"relative"},children:e.jsxs("svg",{viewBox:"0 0 500 150",style:{width:"100%",height:"100%",overflow:"visible"},children:[e.jsx("line",{x1:"0",y1:"150",x2:"500",y2:"150",stroke:"var(--border)"}),e.jsx("line",{x1:"0",y1:"0",x2:"0",y2:"150",stroke:"var(--border)"}),e.jsx("polygon",{points:`0,150 ${R} 500,150`,fill:"var(--accent)",fillOpacity:"0.1"}),e.jsx("polyline",{points:R,fill:"none",stroke:"var(--accent)",strokeWidth:"3",strokeLinecap:"round"}),B.map((t,s)=>e.jsx("circle",{cx:s*100,cy:150-t/E*120,r:"4",fill:"var(--surface)",stroke:"var(--accent)",strokeWidth:"2"},s))]})}),e.jsx("div",{style:{display:"flex",justifyContent:"space-between",marginTop:"15px",color:"var(--text-light)",fontSize:"12px"},children:["Mon-5","Mon-4","Mon-3","Mon-2","Mon-1","Current"].map((t,s)=>e.jsx("span",{children:t},s))})]}),e.jsxs("div",{className:"card",style:{padding:"30px"},children:[e.jsx("h3",{style:{fontSize:"18px",marginBottom:"20px",color:"var(--text-main)"},children:"Points History"}),e.jsx("div",{style:{maxHeight:"300px",overflowY:"auto"},children:k.length===0?e.jsx("p",{style:{color:"var(--text-secondary)",fontStyle:"italic"},children:"No history yet."}):e.jsx("table",{style:{width:"100%",fontSize:"14px",borderCollapse:"collapse"},children:e.jsx("tbody",{children:k.map((t,s)=>e.jsxs("tr",{style:{borderBottom:"1px solid var(--border)"},children:[e.jsx("td",{style:{padding:"10px 0",color:"var(--text-secondary)"},children:new Date(t.date).toLocaleDateString()}),e.jsx("td",{style:{padding:"10px 0",color:"var(--text-main)"},children:t.reason}),e.jsxs("td",{style:{padding:"10px 0",textAlign:"right",fontWeight:"bold",color:t.amount>0?"var(--success)":"#ef4444"},children:[t.amount>0?"+":"",t.amount]})]},s))})})})]})]})]})})};export{J as default};
