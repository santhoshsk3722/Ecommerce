import{u as I,r as o,j as e,m as b,c as U,d as A,e as O,H as _}from"./index-Ddy5vbIH.js";import{P as E}from"./PageTransition-eDQFmkAO.js";const L=({productId:d})=>{const{user:c}=I(),[n,C]=o.useState([]),[t,W]=o.useState(!0),[k,T]=o.useState(5),[z,R]=o.useState(""),[g,h]=o.useState(""),[p,B]=o.useState(!1),[m,r]=o.useState(!1),i=c&&n.some(s=>s.user_id===c.id),j=()=>{const s=n.find(l=>l.user_id===c.id);s&&(T(s.rating),R(s.comment),h(s.image||""),r(!0))};o.useEffect(()=>{d&&a()},[d]);const a=()=>{fetch(`https://techorbit-api.onrender.com/api/reviews/${d}`).then(l=>l.json()).then(l=>{l.message==="success"&&C(l.data),W(!1)})},x=s=>{const l=s.target.files[0];if(l){const u=new FileReader;u.onloadend=()=>{const w=new Image;w.src=u.result,w.onload=()=>{const y=document.createElement("canvas"),H=y.getContext("2d"),S=500;let v=w.width,f=w.height;v>f?v>S&&(f*=S/v,v=S):f>S&&(v*=S/f,f=S),y.width=v,y.height=f,H.drawImage(w,0,0,v,f);const P=y.toDataURL("image/jpeg",.8);h(P)}},u.readAsDataURL(l)}},$=async s=>{if(s.preventDefault(),!c){alert("Please login to write a review");return}B(!0);const l="https://techorbit-api.onrender.com";try{const u=m?"PUT":"POST",y=await(await fetch(`${l}/api/reviews`,{method:u,headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:c.id,product_id:d,rating:parseInt(k),comment:z,image:g})})).json();y.message==="success"?(R(""),h(""),r(!1),a()):alert(y.error||"Something went wrong")}catch(u){console.error("Failed to post review",u)}B(!1)},N=n.length?(n.reduce((s,l)=>s+l.rating,0)/n.length).toFixed(1):0;return e.jsxs("div",{style:{marginTop:"50px",paddingTop:"40px",borderTop:"1px solid var(--border)"},children:[e.jsx("h3",{style:{fontSize:"24px",marginBottom:"30px"},children:"Customer Reviews"}),e.jsxs("div",{className:"responsive-grid-reviews",style:{display:"grid",gridTemplateColumns:"1fr 2fr",gap:"40px"},children:[e.jsxs("div",{style:{background:"var(--surface-hover)",padding:"30px",borderRadius:"16px",height:"fit-content"},children:[e.jsxs("div",{style:{fontSize:"48px",fontWeight:"bold",color:"var(--text-main)",lineHeight:1},children:[N,e.jsx("span",{style:{fontSize:"20px",color:"var(--text-secondary)",marginLeft:"10px"},children:"/ 5"})]}),e.jsx("div",{style:{color:"var(--warning)",fontSize:"20px",margin:"10px 0"},children:"â˜…".repeat(Math.round(N))+"â˜†".repeat(5-Math.round(N))}),e.jsxs("p",{style:{color:"var(--text-secondary)"},children:["Based on ",n.length," reviews"]}),c&&!i||m?e.jsxs("form",{onSubmit:$,style:{marginTop:"30px",borderTop:"1px solid var(--border)",paddingTop:"20px"},children:[e.jsx("h4",{style:{marginBottom:"15px"},children:m?"Update your Review":"Write a Review"}),e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"5px",fontSize:"14px"},children:"Rating"}),e.jsx("div",{style:{display:"flex",gap:"5px"},children:[1,2,3,4,5].map(s=>e.jsx("span",{onClick:()=>T(s),style:{cursor:"pointer",fontSize:"24px",color:s<=k?"var(--warning)":"#cbd5e1"},children:"â˜…"},s))})]}),e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsxs("label",{style:{display:"block",marginBottom:"5px",fontSize:"14px",cursor:"pointer",color:"var(--accent)"},children:["ðŸ“· Add Photo",e.jsx("input",{type:"file",accept:"image/*",onChange:x,style:{display:"none"}})]}),g&&e.jsxs("div",{style:{marginTop:"10px",position:"relative",width:"fit-content"},children:[e.jsx("img",{src:g,alt:"Review Preview",style:{maxHeight:"100px",borderRadius:"8px",border:"1px solid var(--border)"}}),e.jsx("button",{type:"button",onClick:()=>h(""),style:{position:"absolute",top:"-5px",right:"-5px",background:"red",color:"white",borderRadius:"50%",width:"20px",height:"20px",border:"none",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px"},children:"âœ•"})]})]}),e.jsx("textarea",{value:z,onChange:s=>R(s.target.value),placeholder:"Share your thoughts...",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid var(--border)",marginBottom:"15px",background:"var(--surface)",color:"var(--text-main)"},rows:"3",required:!0}),e.jsx("button",{type:"submit",disabled:p,className:"btn btn-primary",style:{width:"100%",padding:"10px"},children:p?"Submitting...":m?"Update Review":"Post Review"}),m&&e.jsx("button",{type:"button",onClick:()=>r(!1),style:{width:"100%",marginTop:"10px",padding:"10px",background:"transparent",border:"none",color:"var(--text-secondary)",cursor:"pointer"},children:"Cancel"})]}):i&&!m?e.jsxs("div",{style:{marginTop:"30px",padding:"15px",background:"#ecfdf5",color:"#047857",borderRadius:"8px",textAlign:"center",border:"1px solid #a7f3d0"},children:[e.jsx("div",{children:"âœ… You have already reviewed this product."}),e.jsx("button",{onClick:j,style:{marginTop:"10px",background:"transparent",border:"1px solid #047857",color:"#047857",padding:"5px 15px",borderRadius:"6px",cursor:"pointer",fontSize:"12px",fontWeight:"bold"},children:"Edit Review"})]}):e.jsxs("div",{style:{marginTop:"20px",padding:"15px",background:"var(--surface)",borderRadius:"8px",textAlign:"center"},children:[e.jsx("a",{href:"/#/login",style:{color:"var(--primary)",fontWeight:"bold"},children:"Login"})," to write a review."]})]}),e.jsx("div",{children:t?e.jsx("p",{children:"Loading reviews..."}):n.length===0?e.jsx("div",{style:{padding:"40px",textAlign:"center",background:"var(--surface)",borderRadius:"12px"},children:e.jsx("p",{style:{color:"var(--text-secondary)"},children:"No reviews yet. Be the first!"})}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"20px"},children:n.map(s=>e.jsxs(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},style:{padding:"20px",background:"var(--surface)",borderRadius:"12px",border:"1px solid var(--border)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"10px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx("div",{style:{width:"32px",height:"32px",borderRadius:"50%",background:"var(--primary-gradient)",color:"white",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:"bold",fontSize:"12px"},children:s.user_name?s.user_name.charAt(0).toUpperCase():"U"}),e.jsx("strong",{children:s.user_name})]}),e.jsx("div",{style:{color:"var(--warning)",fontSize:"14px"},children:"â˜…".repeat(s.rating)+"â˜†".repeat(5-s.rating)})]}),e.jsx("p",{style:{color:"var(--text-secondary)",lineHeight:1.6,margin:"10px 0"},children:s.comment}),s.image&&e.jsx("div",{style:{marginTop:"10px",marginBottom:"10px"},children:e.jsx("img",{src:s.image,alt:"Review",style:{maxHeight:"150px",borderRadius:"8px",border:"1px solid var(--border)"}})}),e.jsx("div",{style:{fontSize:"12px",color:"var(--text-light)"},children:new Date(s.date).toLocaleDateString()})]},s.id))})})]})]})},J=()=>{const{id:d}=U(),c=A(),{user:n}=I(),{addToCart:C}=O(),[t,W]=o.useState(null),[k,T]=o.useState([]),[z,R]=o.useState(!0),[g,h]=o.useState(!1),[p,B]=o.useState({});o.useEffect(()=>{const r="https://techorbit-api.onrender.com";fetch(`${r}/api/products/${d}`).then(i=>i.json()).then(i=>{if(i.message==="success"){W(i.data);const a=JSON.parse(localStorage.getItem("viewHistory")||"[]").filter(x=>x.id!==i.data.id);a.unshift({id:i.data.id,title:i.data.title,image:i.data.image,price:i.data.price,category:i.data.category}),a.length>10&&a.pop(),localStorage.setItem("viewHistory",JSON.stringify(a)),fetch(`${r}/api/products?category=${i.data.category}&excludeId=${d}&limit=4`).then(x=>x.json()).then(x=>{x.message==="success"&&T(x.data)})}R(!1)})},[d]),o.useEffect(()=>{n&&d&&fetch(`https://techorbit-api.onrender.com/api/wishlist/${n.id}`).then(i=>i.json()).then(i=>{if(i.message==="success"){const j=i.data.some(a=>a.product_id==d||a.id==d);h(j)}}).catch(i=>console.error("Wishlist check failed",i))},[d,n]);const m=async()=>{if(!n){c("/login");return}const r="https://techorbit-api.onrender.com";try{g?(await fetch(`${r}/api/wishlist/remove/${n.id}/${t.id}`,{method:"DELETE"}),h(!1)):(await fetch(`${r}/api/wishlist`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:n.id,product_id:t.id})}),h(!0))}catch(i){console.error(i)}};return z?e.jsx("div",{className:"container",style:{padding:"50px"},children:"Loading product details..."}):t?e.jsxs(E,{children:[t&&e.jsxs(_,{children:[e.jsxs("title",{children:[t.title," - TechOrbit"]}),e.jsx("meta",{name:"description",content:t.description?.substring(0,160)||`Buy ${t.title} at the best price on TechOrbit.`})]}),e.jsxs("div",{className:"container",children:[e.jsxs("div",{className:"responsive-grid-detail",children:[e.jsx(b.div,{className:"product-detail-image-wrapper",initial:{opacity:0,x:-50},animate:{opacity:1,x:0},transition:{duration:.6},children:e.jsx(b.img,{whileHover:{scale:1.05},transition:{duration:.3},src:t.image,alt:t.title,style:{maxWidth:"100%",maxHeight:"500px",objectFit:"contain"}})}),e.jsxs(b.div,{initial:{opacity:0,x:50},animate:{opacity:1,x:0},transition:{duration:.6,delay:.2},children:[e.jsx("div",{style:{marginBottom:"10px",textTransform:"uppercase",letterSpacing:"1px",color:"var(--accent)",fontWeight:"bold",fontSize:"14px"},children:t.category}),e.jsx("h1",{style:{fontSize:"42px",fontWeight:"800",lineHeight:1.2,marginBottom:"20px"},children:t.title}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"20px",marginBottom:"30px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",background:"var(--success)",color:"white",padding:"4px 12px",borderRadius:"20px",fontWeight:"bold"},children:[t.average_rating?Number(t.average_rating).toFixed(1):"New"," â˜…"]}),e.jsx("span",{style:{color:"var(--text-secondary)"},children:t.review_count?`${t.review_count} Verified Reviews`:"No reviews yet"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"30px"},children:[e.jsxs("div",{style:{fontSize:"36px",fontWeight:"700",color:"var(--primary)",display:"flex",alignItems:"center",gap:"15px"},children:["$",t.price,e.jsxs("span",{style:{fontSize:"20px",color:"var(--text-light)",textDecoration:"line-through",fontWeight:"normal"},children:["$",(t.price*1.2).toFixed(2)]})]}),e.jsx("button",{onClick:m,style:{background:"none",border:"none",cursor:"pointer",fontSize:"28px",color:g?"var(--error)":"var(--text-light)",transition:"transform 0.2s",padding:"10px"},title:g?"Remove from Wishlist":"Add to Wishlist",children:g?"â¤ï¸":"ðŸ¤"})]}),e.jsxs("div",{style:{background:"var(--surface-hover)",padding:"20px",borderRadius:"12px",borderLeft:"4px solid var(--accent)",marginBottom:"30px"},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"10px",color:"var(--accent)",fontWeight:"800"},children:e.jsx("span",{children:"ðŸ¤– AI Verdict"})}),e.jsxs("p",{style:{fontSize:"14px",color:"var(--text-secondary)",fontStyle:"italic",margin:0},children:['"Customers love the ',e.jsx("strong",{children:"build quality"})," and ",e.jsx("strong",{children:"value for money"}),". Some verified users mentioned the ",e.jsx("strong",{children:"shipping"})," was faster than expected. Highly recommended for ",e.jsx("strong",{children:t.category}),' enthusiasts."']})]}),e.jsx("p",{style:{fontSize:"18px",color:"var(--text-secondary)",lineHeight:1.8,marginBottom:"40px"},children:t.description}),e.jsxs("div",{style:{display:"flex",gap:"20px",flexDirection:"column"},children:[t.variants&&(()=>{let r=[];try{r=typeof t.variants=="string"?JSON.parse(t.variants):t.variants}catch{r=[]}return!r||r.length===0?null:e.jsx("div",{style:{marginBottom:"25px",padding:"15px",background:"var(--surface)",borderRadius:"8px",border:"1px solid var(--border)"},children:r.map((i,j)=>e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:"8px",fontSize:"14px"},children:[i.name,":"]}),e.jsx("div",{style:{display:"flex",gap:"10px",flexWrap:"wrap"},children:i.options.map(a=>e.jsx("button",{onClick:()=>B(x=>({...x,[i.name]:a})),style:{padding:"6px 14px",borderRadius:"20px",border:p[i.name]===a?"2px solid var(--primary)":"1px solid var(--border)",background:p[i.name]===a?"var(--primary)":"var(--surface-hover)",color:p[i.name]===a?"white":"var(--text-main)",cursor:"pointer",fontSize:"13px",transition:"all 0.2s"},children:a},a))})]},j))})})(),n&&(n.role==="seller"||n.role==="admin")?e.jsxs("div",{style:{padding:"15px",background:"var(--surface-hover)",color:"var(--text-secondary)",borderRadius:"8px",textAlign:"center",border:"1px solid var(--border)",fontSize:"14px"},children:["ðŸ”’ Signed in as ",n.role.charAt(0).toUpperCase()+n.role.slice(1),". ",e.jsx("br",{}),"Please ",e.jsx("span",{style:{color:"var(--primary)",cursor:"pointer",fontWeight:"bold"},onClick:()=>c("/login"),children:"login as a customer"})," to purchase."]}):t.stock!==void 0&&t.stock<=0?e.jsx("div",{style:{padding:"15px",background:"rgba(239, 68, 68, 0.1)",color:"var(--error)",borderRadius:"8px",textAlign:"center",fontWeight:"bold",border:"1px solid rgba(239, 68, 68, 0.3)"},children:"ðŸš« Out of Stock"}):e.jsxs("div",{style:{display:"flex",gap:"20px"},children:[e.jsx(b.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>{let r=0;try{const i=typeof t.variants=="string"?JSON.parse(t.variants):t.variants;i&&(r=i.length)}catch{}if(r>0&&Object.keys(p).length<r){alert("Please select all options (Size, Color, etc.)");return}C({...t,selectedVariants:p})},className:"btn btn-secondary",style:{flex:1,padding:"20px",fontSize:"18px"},children:"Add to Cart"}),e.jsx(b.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>{let r=0;try{const i=typeof t.variants=="string"?JSON.parse(t.variants):t.variants;i&&(r=i.length)}catch{}if(r>0&&Object.keys(p).length<r){alert("Please select all options (Size, Color, etc.)");return}C({...t,selectedVariants:p}),c("/cart")},className:"btn btn-primary",style:{flex:1,padding:"20px",fontSize:"18px"},children:"Buy Now"})]}),t.stock!==void 0&&t.stock>0&&t.stock<10&&e.jsxs("div",{style:{color:"var(--error)",fontSize:"14px",fontWeight:"600",textAlign:"center"},children:["ðŸ”¥ Hurry! Only ",t.stock," left in stock."]})]}),e.jsxs("div",{style:{display:"flex",gap:"30px",marginTop:"40px",borderTop:"1px solid var(--border)",paddingTop:"30px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",color:"var(--text-secondary)"},children:[e.jsx("span",{children:"ðŸšš"})," Free Shipping"]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",color:"var(--text-secondary)"},children:[e.jsx("span",{children:"ðŸ›¡ï¸"})," 2 Year Warranty"]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",color:"var(--text-secondary)"},children:[e.jsx("span",{children:"â†©ï¸"})," 30 Day Returns"]})]})]})]}),e.jsx(L,{productId:t.id}),k.length>0&&e.jsxs("div",{style:{marginTop:"80px",borderTop:"1px solid var(--border)",paddingTop:"40px"},children:[e.jsx("h2",{style:{marginBottom:"30px"},children:"You might also like"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:"30px"},children:k.map(r=>e.jsx(b.div,{whileHover:{y:-5},onClick:()=>c(`/product/${r.id}`),style:{cursor:"pointer"},children:e.jsxs("div",{style:{background:"var(--surface)",borderRadius:"8px",padding:"20px",textAlign:"center",boxShadow:"0 2px 8px rgba(0,0,0,0.05)",height:"100%"},children:[e.jsx("img",{src:r.image,alt:r.title,style:{width:"100%",height:"150px",objectFit:"contain",marginBottom:"15px"}}),e.jsx("h4",{style:{fontSize:"16px",margin:"0 0 10px 0",height:"40px",overflow:"hidden"},children:r.title}),e.jsxs("div",{style:{color:"var(--primary)",fontWeight:"bold"},children:["$",r.price]})]})},r.id))})]})]})]}):e.jsx("div",{className:"container",children:"Product not found"})};export{J as default};
