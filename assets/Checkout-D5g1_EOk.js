import{r as y,j as r,m as ee,i as Te,l as h,A as Ae,u as Ie,e as Ue,g as ze,d as _e,L as le}from"./index-CZ-q80kR.js";import{a as Ne}from"./emailService-Cs8ouLn9.js";import"./index-DtVQIX_c.js";const We=({amount:n,onSuccess:e,onClose:t})=>{const[o,i]=y.useState("input"),[a,l]=y.useState(""),[d,s]=y.useState(!1),[u,x]=y.useState(""),g=()=>{if(!a.includes("@")){x("Invalid UPI ID (must contain @)");return}s(!0),x(""),setTimeout(()=>{s(!1),i("processing")},1500)};return y.useEffect(()=>{if(o==="processing"){const c=setTimeout(()=>{e()},4e3);return()=>clearTimeout(c)}},[o,e]),r.jsxs("div",{style:{minHeight:"300px",display:"flex",flexDirection:"column",justifyContent:"center"},children:[o==="input"&&r.jsxs("div",{style:{textAlign:"center"},children:[r.jsx("h4",{style:{marginBottom:"20px"},children:"Enter UPI ID / VPA"}),r.jsx("input",{type:"text",placeholder:"example@okhdfcbank",value:a,onChange:c=>l(c.target.value),style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid var(--border)",background:"var(--surface)",color:"var(--text-main)",marginBottom:"10px",fontSize:"16px"}}),u&&r.jsx("div",{style:{color:"var(--error)",fontSize:"12px",marginBottom:"10px"},children:u}),r.jsx("button",{onClick:g,disabled:d,className:"btn btn-primary",style:{width:"100%",marginTop:"10px"},children:d?"Verifying...":`Pay $${n.toFixed(2)}`}),r.jsxs("div",{style:{marginTop:"20px",display:"flex",gap:"10px",justifyContent:"center",opacity:.6},children:[r.jsx("span",{children:"Google Pay"})," â€¢ ",r.jsx("span",{children:"PhonePe"})," â€¢ ",r.jsx("span",{children:"Paytm"})]})]}),o==="processing"&&r.jsxs("div",{style:{textAlign:"center"},children:[r.jsx(ee.div,{animate:{scale:[1,1.1,1],opacity:[.5,1,.5]},transition:{repeat:1/0,duration:2},style:{fontSize:"40px",marginBottom:"20px"},children:"ðŸ“±"}),r.jsxs("h4",{style:{marginBottom:"10px"},children:["Request Sent to ",a]}),r.jsxs("p",{style:{color:"var(--text-secondary)",fontSize:"14px"},children:["Please open your UPI App on your phone and approve the payment of ",r.jsxs("b",{children:["$",n.toFixed(2)]}),"."]}),r.jsx("div",{style:{marginTop:"30px",width:"100%",height:"4px",background:"var(--border)",borderRadius:"2px",overflow:"hidden"},children:r.jsx(ee.div,{initial:{width:"0%"},animate:{width:"100%"},transition:{duration:4},style:{height:"100%",background:"var(--success)"}})})]})]})};var ge="clover",Le=function(e){return e===3?"v3":e},be="https://js.stripe.com",Be="".concat(be,"/").concat(ge,"/stripe.js"),De=/^https:\/\/js\.stripe\.com\/v3\/?(\?.*)?$/,Fe=/^https:\/\/js\.stripe\.com\/(v3|[a-z]+)\/stripe\.js(\?.*)?$/;var Me=function(e){return De.test(e)||Fe.test(e)},$e=function(){for(var e=document.querySelectorAll('script[src^="'.concat(be,'"]')),t=0;t<e.length;t++){var o=e[t];if(Me(o.src))return o}return null},de=function(e){var t="",o=document.createElement("script");o.src="".concat(Be).concat(t);var i=document.head||document.body;if(!i)throw new Error("Expected document.body not to be null. Stripe.js requires a <body> element.");return i.appendChild(o),o},qe=function(e,t){!e||!e._registerWrapper||e._registerWrapper({name:"stripe-js",version:"8.6.1",startTime:t})},q=null,Z=null,X=null,Ve=function(e){return function(t){e(new Error("Failed to load Stripe.js",{cause:t}))}},Je=function(e,t){return function(){window.Stripe?e(window.Stripe):t(new Error("Stripe.js not available"))}},Ye=function(e){return q!==null?q:(q=new Promise(function(t,o){if(typeof window>"u"||typeof document>"u"){t(null);return}if(window.Stripe){t(window.Stripe);return}try{var i=$e();if(!(i&&e)){if(!i)i=de(e);else if(i&&X!==null&&Z!==null){var a;i.removeEventListener("load",X),i.removeEventListener("error",Z),(a=i.parentNode)===null||a===void 0||a.removeChild(i),i=de(e)}}X=Je(t,o),Z=Ve(o),i.addEventListener("load",X),i.addEventListener("error",Z)}catch(l){o(l);return}}),q.catch(function(t){return q=null,Promise.reject(t)}))},Ge=function(e,t,o){if(e===null)return null;var i=t[0],a=i.match(/^pk_test/),l=Le(e.version),d=ge;a&&l!==d&&console.warn("Stripe.js@".concat(l," was loaded on the page, but @stripe/stripe-js@").concat("8.6.1"," expected Stripe.js@").concat(d,". This may result in unexpected behavior. For more information, see https://docs.stripe.com/sdks/stripejs-versioning"));var s=e.apply(void 0,t);return qe(s,o),s},V,Se=!1,je=function(){return V||(V=Ye(null).catch(function(e){return V=null,Promise.reject(e)}),V)};Promise.resolve().then(function(){return je()}).catch(function(n){Se||console.warn(n)});var He=function(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];Se=!0;var i=Date.now();return je().then(function(a){return Ge(a,t,i)})},oe={exports:{}},ie,pe;function Ke(){if(pe)return ie;pe=1;var n="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED";return ie=n,ie}var ae,ue;function Ze(){if(ue)return ae;ue=1;var n=Ke();function e(){}function t(){}return t.resetWarningCache=e,ae=function(){function o(l,d,s,u,x,g){if(g!==n){var c=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw c.name="Invariant Violation",c}}o.isRequired=o;function i(){return o}var a={array:o,bigint:o,bool:o,func:o,number:o,object:o,string:o,symbol:o,any:o,arrayOf:i,element:o,elementType:o,instanceOf:i,node:o,objectOf:i,oneOf:i,oneOfType:i,shape:i,exact:i,checkPropTypes:t,resetWarningCache:e};return a.PropTypes=a,a},ae}var fe;function Xe(){return fe||(fe=1,oe.exports=Ze()()),oe.exports}var Qe=Xe();const f=Te(Qe);function he(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(n);e&&(o=o.filter(function(i){return Object.getOwnPropertyDescriptor(n,i).enumerable})),t.push.apply(t,o)}return t}function xe(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?he(Object(t),!0).forEach(function(o){Ce(n,o,t[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):he(Object(t)).forEach(function(o){Object.defineProperty(n,o,Object.getOwnPropertyDescriptor(t,o))})}return n}function Q(n){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Q=function(e){return typeof e}:Q=function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Q(n)}function Ce(n,e,t){return e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function et(n,e){if(n==null)return{};var t={},o=Object.keys(n),i,a;for(a=0;a<o.length;a++)i=o[a],!(e.indexOf(i)>=0)&&(t[i]=n[i]);return t}function tt(n,e){if(n==null)return{};var t=et(n,e),o,i;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);for(i=0;i<a.length;i++)o=a[i],!(e.indexOf(o)>=0)&&Object.prototype.propertyIsEnumerable.call(n,o)&&(t[o]=n[o])}return t}function Pe(n,e){return rt(n)||nt(n,e)||ot(n,e)||it()}function rt(n){if(Array.isArray(n))return n}function nt(n,e){var t=n&&(typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"]);if(t!=null){var o=[],i=!0,a=!1,l,d;try{for(t=t.call(n);!(i=(l=t.next()).done)&&(o.push(l.value),!(e&&o.length===e));i=!0);}catch(s){a=!0,d=s}finally{try{!i&&t.return!=null&&t.return()}finally{if(a)throw d}}return o}}function ot(n,e){if(n){if(typeof n=="string")return me(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return me(n,e)}}function me(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,o=new Array(e);t<e;t++)o[t]=n[t];return o}function it(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var E=function(e,t,o){var i=!!o,a=h.useRef(o);h.useEffect(function(){a.current=o},[o]),h.useEffect(function(){if(!i||!e)return function(){};var l=function(){a.current&&a.current.apply(a,arguments)};return e.on(t,l),function(){e.off(t,l)}},[i,t,e,a])},se=function(e){var t=h.useRef(e);return h.useEffect(function(){t.current=e},[e]),t.current},M=function(e){return e!==null&&Q(e)==="object"},at=function(e){return M(e)&&typeof e.then=="function"},st=function(e){return M(e)&&typeof e.elements=="function"&&typeof e.createToken=="function"&&typeof e.createPaymentMethod=="function"&&typeof e.confirmCardPayment=="function"},ye="[object Object]",ct=function n(e,t){if(!M(e)||!M(t))return e===t;var o=Array.isArray(e),i=Array.isArray(t);if(o!==i)return!1;var a=Object.prototype.toString.call(e)===ye,l=Object.prototype.toString.call(t)===ye;if(a!==l)return!1;if(!a&&!o)return e===t;var d=Object.keys(e),s=Object.keys(t);if(d.length!==s.length)return!1;for(var u={},x=0;x<d.length;x+=1)u[d[x]]=!0;for(var g=0;g<s.length;g+=1)u[s[g]]=!0;var c=Object.keys(u);if(c.length!==d.length)return!1;var U=e,v=t,O=function(N){return n(U[N],v[N])};return c.every(O)},Ee=function(e,t,o){return M(e)?Object.keys(e).reduce(function(i,a){var l=!M(t)||!ct(e[a],t[a]);return o.includes(a)?(l&&console.warn("Unsupported prop change: options.".concat(a," is not a mutable property.")),i):l?xe(xe({},i||{}),{},Ce({},a,e[a])):i},null):null},we="Invalid prop `stripe` supplied to `Elements`. We recommend using the `loadStripe` utility from `@stripe/stripe-js`. See https://stripe.com/docs/stripe-js/react#elements-props-stripe for details.",ve=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:we;if(e===null||st(e))return e;throw new Error(t)},lt=function(e){var t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:we;if(at(e))return{tag:"async",stripePromise:Promise.resolve(e).then(function(i){return ve(i,t)})};var o=ve(e,t);return o===null?{tag:"empty"}:{tag:"sync",stripe:o}},dt=function(e){!e||!e._registerWrapper||!e.registerAppInfo||(e._registerWrapper({name:"react-stripe-js",version:"5.4.1"}),e.registerAppInfo({name:"react-stripe-js",version:"5.4.1",url:"https://stripe.com/docs/stripe-js/react"}))},te=h.createContext(null);te.displayName="ElementsContext";var ke=function(e,t){if(!e)throw new Error("Could not find Elements context; You need to wrap the part of your app that ".concat(t," in an <Elements> provider."));return e},Oe=function(e){var t=e.stripe,o=e.options,i=e.children,a=h.useMemo(function(){return lt(t)},[t]),l=h.useState(function(){return{stripe:a.tag==="sync"?a.stripe:null,elements:a.tag==="sync"?a.stripe.elements(o):null}}),d=Pe(l,2),s=d[0],u=d[1];h.useEffect(function(){var c=!0,U=function(O){u(function(_){return _.stripe?_:{stripe:O,elements:O.elements(o)}})};return a.tag==="async"&&!s.stripe?a.stripePromise.then(function(v){v&&c&&U(v)}):a.tag==="sync"&&!s.stripe&&U(a.stripe),function(){c=!1}},[a,s,o]);var x=se(t);h.useEffect(function(){x!==null&&x!==t&&console.warn("Unsupported prop change on Elements: You cannot change the `stripe` prop after setting it.")},[x,t]);var g=se(o);return h.useEffect(function(){if(s.elements){var c=Ee(o,g,["clientSecret","fonts"]);c&&s.elements.update(c)}},[o,g,s.elements]),h.useEffect(function(){dt(s.stripe)},[s.stripe]),h.createElement(te.Provider,{value:s},i)};Oe.propTypes={stripe:f.any,options:f.object};var pt=function(e){var t=h.useContext(te);return ke(t,e)},ut=function(){var e=pt("calls useElements()"),t=e.elements;return t};f.func.isRequired;var Re=h.createContext(null);Re.displayName="CheckoutContext";f.any,f.shape({clientSecret:f.oneOfType([f.string,f.instanceOf(Promise)]).isRequired,elementsOptions:f.object}).isRequired;var ce=function(e){var t=h.useContext(Re),o=h.useContext(te);if(t){if(o)throw new Error("You cannot wrap the part of your app that ".concat(e," in both <CheckoutProvider> and <Elements> providers."));return t}else return ke(o,e)},ft=["mode"],ht=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},w=function(e,t){var o="".concat(ht(e),"Element"),i=function(s){var u=s.id,x=s.className,g=s.options,c=g===void 0?{}:g,U=s.onBlur,v=s.onFocus,O=s.onReady,_=s.onChange,N=s.onEscape,J=s.onClick,re=s.onLoadError,Y=s.onLoaderStart,ne=s.onNetworksChange,G=s.onConfirm,H=s.onCancel,K=s.onShippingAddressChange,A=s.onShippingRateChange,R=s.onSavedPaymentMethodRemove,W=s.onSavedPaymentMethodUpdate,D=ce("mounts <".concat(o,">")),F="elements"in D?D.elements:null,I="checkoutState"in D?D.checkoutState:null,T=I?.type==="success"||I?.type==="loading"?I.sdk:null,z=h.useState(null),$=Pe(z,2),C=$[0],m=$[1],p=h.useRef(null),b=h.useRef(null);E(C,"blur",U),E(C,"focus",v),E(C,"escape",N),E(C,"click",J),E(C,"loaderror",re),E(C,"loaderstart",Y),E(C,"networkschange",ne),E(C,"confirm",G),E(C,"cancel",H),E(C,"shippingaddresschange",K),E(C,"shippingratechange",A),E(C,"savedpaymentmethodremove",R),E(C,"savedpaymentmethodupdate",W),E(C,"change",_);var P;O&&(e==="expressCheckout"?P=O:P=function(){O(C)}),E(C,"ready",P),h.useLayoutEffect(function(){if(p.current===null&&b.current!==null&&(F||T)){var j=null;if(T)switch(e){case"paymentForm":j=T.createPaymentFormElement();break;case"payment":j=T.createPaymentElement(c);break;case"address":if("mode"in c){var L=c.mode,B=tt(c,ft);if(L==="shipping")j=T.createShippingAddressElement(B);else if(L==="billing")j=T.createBillingAddressElement(B);else throw new Error("Invalid options.mode. mode must be 'billing' or 'shipping'.")}else throw new Error("You must supply options.mode. mode must be 'billing' or 'shipping'.");break;case"expressCheckout":j=T.createExpressCheckoutElement(c);break;case"currencySelector":j=T.createCurrencySelectorElement();break;case"taxId":j=T.createTaxIdElement(c);break;default:throw new Error("Invalid Element type ".concat(o,". You must use either the <PaymentElement />, <AddressElement options={{mode: 'shipping'}} />, <AddressElement options={{mode: 'billing'}} />, or <ExpressCheckoutElement />."))}else F&&(j=F.create(e,c));p.current=j,m(j),j&&j.mount(b.current)}},[F,T,c]);var S=se(c);return h.useEffect(function(){if(p.current){var j=Ee(c,S,["paymentRequest"]);j&&"update"in p.current&&p.current.update(j)}},[c,S]),h.useLayoutEffect(function(){return function(){if(p.current&&typeof p.current.destroy=="function")try{p.current.destroy(),p.current=null}catch{}}},[]),h.createElement("div",{id:u,className:x,ref:b})},a=function(s){ce("mounts <".concat(o,">"));var u=s.id,x=s.className;return h.createElement("div",{id:u,className:x})},l=t?a:i;return l.propTypes={id:f.string,className:f.string,onChange:f.func,onBlur:f.func,onFocus:f.func,onReady:f.func,onEscape:f.func,onClick:f.func,onLoadError:f.func,onLoaderStart:f.func,onNetworksChange:f.func,onConfirm:f.func,onCancel:f.func,onShippingAddressChange:f.func,onShippingRateChange:f.func,onSavedPaymentMethodRemove:f.func,onSavedPaymentMethodUpdate:f.func,options:f.object},l.displayName=o,l.__elementType=e,l},k=typeof window>"u",xt=h.createContext(null);xt.displayName="EmbeddedCheckoutProviderContext";var mt=function(){var e=ce("calls useStripe()"),t=e.stripe;return t};w("auBankAccount",k);w("card",k);w("cardNumber",k);w("cardExpiry",k);w("cardCvc",k);w("iban",k);var yt=w("payment",k);w("expressCheckout",k);w("paymentRequestButton",k);w("linkAuthentication",k);w("address",k);w("shippingAddress",k);w("paymentMethodMessaging",k);w("taxId",k);const vt=He("pk_live_51SmqZ7RgYSu8FyQzduCzyCTGPGSa19wpdO261mWzFYrgdZQrJdP0UsFujxy4Yntrks9m3Vvq5YVteEddJWPnZNhi00ZyTHWOfM"),gt=({amount:n,onSuccess:e,onClose:t})=>{const o=mt(),i=ut(),[a,l]=y.useState(null),[d,s]=y.useState(!1),u=async x=>{if(x.preventDefault(),!o||!i)return;s(!0);const{error:g,paymentIntent:c}=await o.confirmPayment({elements:i,confirmParams:{return_url:window.location.origin},redirect:"if_required"});g?(l(g.message),s(!1)):c&&c.status==="succeeded"?e():(l("Unexpected state."),s(!1))};return r.jsxs("form",{onSubmit:u,children:[r.jsx(yt,{}),a&&r.jsx("div",{style:{color:"red",marginTop:"10px",fontSize:"14px"},children:a}),r.jsxs("div",{style:{display:"flex",gap:"10px",marginTop:"20px"},children:[r.jsx("button",{disabled:d||!o||!i,id:"submit",className:"btn btn-primary",style:{flex:1},children:d?"Processing...":`Pay $${n.toFixed(2)}`}),r.jsx("button",{type:"button",onClick:t,className:"btn btn-secondary",disabled:d,children:"Cancel"})]})]})},bt=({amount:n,onSuccess:e,onClose:t})=>{const[o,i]=y.useState(""),[a,l]=y.useState(null);y.useEffect(()=>{n>0&&fetch("https://techorbit-api.onrender.com/api/create-payment-intent",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:n})}).then(async u=>{if(!u.ok){const x=await u.json().catch(()=>({}));throw new Error(x.error||"Payment service unavailable.")}return u.json()}).then(u=>{if(u.error)throw new Error(u.error);i(u.clientSecret)}).catch(u=>l(u.message))},[n]);const d={clientSecret:o,appearance:{theme:"night",variables:{colorPrimary:"#2563eb"}}};return a?r.jsxs("div",{style:{textAlign:"center",padding:"20px",color:"var(--error)"},children:[r.jsxs("div",{style:{marginBottom:"10px"},children:["âš ï¸ ",a]}),r.jsx("div",{style:{fontSize:"12px",color:"var(--text-secondary)"},children:"(Hint: Did you restart the server after adding Stripe keys?)"})]}):r.jsx("div",{style:{minHeight:"300px",display:"flex",flexDirection:"column",justifyContent:"center"},children:o?r.jsx(Oe,{options:d,stripe:vt,children:r.jsx(gt,{amount:n,onSuccess:e,onClose:t})}):r.jsx("div",{style:{textAlign:"center",color:"var(--text-secondary)"},children:"Loading Secure Payment..."})})},St=({isOpen:n,onClose:e,onConfirm:t,total:o,method:i})=>r.jsx(Ae,{children:n&&r.jsxs("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",zIndex:1e3,display:"flex",alignItems:"center",justifyContent:"center"},children:[r.jsx(ee.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:e,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",background:"rgba(0,0,0,0.5)"}}),r.jsxs(ee.div,{initial:{scale:.9,opacity:0,y:20},animate:{scale:1,opacity:1,y:0},exit:{scale:.9,opacity:0,y:20},style:{position:"relative",background:"var(--surface)",padding:"30px",borderRadius:"12px",width:"90%",maxWidth:"450px",zIndex:1001,boxShadow:"var(--shadow-lg)",color:"var(--text-main)"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"20px"},children:[r.jsx("h3",{style:{margin:0,fontSize:"20px"},children:i==="UPI"?"Pay via UPI / GPay":"Secure Card Payment"}),r.jsx("button",{onClick:e,style:{background:"none",border:"none",fontSize:"24px",cursor:"pointer",color:"var(--text-secondary)"},children:"Ã—"})]}),i==="UPI"?r.jsx(We,{amount:o,onSuccess:t,onClose:e}):r.jsx(bt,{amount:o,onSuccess:t,onClose:e})]})]})}),Et=()=>{const{user:n}=Ie(),{cart:e,cartTotal:t,clearCart:o}=Ue(),{points:i,spendPoints:a}=ze();_e();const[l,d]=y.useState(""),[s,u]=y.useState(""),[x,g]=y.useState(0),[c,U]=y.useState(0),[v,O]=y.useState("Card"),[_,N]=y.useState(!1),[J,re]=y.useState(""),[Y,ne]=y.useState(""),[G,H]=y.useState(!1);y.useEffect(()=>{K()},[]);const K=()=>{const m="ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";let p="";for(let b=0;b<5;b++)p+=m.charAt(Math.floor(Math.random()*m.length));re(p)},[A,R]=y.useState({}),[W,D]=y.useState(null);y.useEffect(()=>{if(n&&n.address){const m=[n.address,n.city,n.zip,n.country].filter(Boolean).join(", ");d(m)}},[n]),y.useEffect(()=>{W&&window.scrollTo(0,0)},[W]);const F=()=>{if(!s.trim())return;fetch("https://techorbit-api.onrender.com/api/coupons/validate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:s})}).then(p=>p.json()).then(p=>{if(p.message==="success"){const b=p.data;let P=0;b.discount_type==="percent"?P=t*b.discount_value/100:b.discount_type==="fixed"&&(P=b.discount_value),P>t&&(P=t),g(P),R(S=>({...S,coupon:null}))}else R(b=>({...b,coupon:p.error||"Invalid coupon"})),g(0)}).catch(p=>R(b=>({...b,coupon:"Validation failed"})))},I=async()=>{const m=["WELCOME10","SAVE20","FREESHIP"];let p=0,b="";R(S=>({...S,coupon:"Finding best deal..."}));const P="https://techorbit-api.onrender.com";for(const S of m)try{const L=await(await fetch(`${P}/api/coupons/validate`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({code:S,cartTotal:t})})).json();if(L.message==="success"){let B=0;L.data.discount_type==="percent"?B=t*L.data.discount_value/100:B=L.data.discount_value,B>p&&(p=B,b=S)}}catch{continue}p>0?(g(p),u(b),R(S=>({...S,coupon:null}))):R(S=>({...S,coupon:"No better coupons found."}))},T=c/10,z=Math.max(0,t-x-T),$=async()=>{try{const m={user_id:n.id,total:z,items:e.map(S=>({product_id:S.id,quantity:S.quantity,price:S.price})),shipping_address:l,payment_method:v,coupon_code:s||null,discount_amount:x},P=await(await fetch("https://techorbit-api.onrender.com/api/orders",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(m)})).json();P.message==="success"?(Ne(P.orderId,n,e,z,l),c>0&&a(c),D(P.orderId),o()):R(S=>({...S,general:"Failed to place order: "+(P.error||"Unknown error")}))}catch{R(p=>({...p,general:"Network error. Please try again."}))}},C=()=>{const m={};if(l.trim()||(m.address="Shipping address is required."),Object.keys(m).length>0){R(m);return}if(v==="COD"){if(Y!==J){H(!0);return}$()}else N(!0)};return n?W?r.jsxs("div",{style:{maxWidth:"600px",margin:"40px auto",background:"var(--surface)",padding:"50px",borderRadius:"16px",boxShadow:"var(--shadow-lg)",textAlign:"center"},children:[r.jsx("div",{style:{width:"80px",height:"80px",background:"var(--success)",color:"white",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"40px",margin:"0 auto 20px"},children:"âœ“"}),r.jsx("h2",{style:{fontSize:"28px",color:"var(--text-main)",marginBottom:"10px"},children:"Order Placed Successfully!"}),r.jsxs("p",{style:{color:"var(--text-secondary)",marginBottom:"30px"},children:["Your order #",W," has been confirmed. We will ship it shortly."]}),r.jsxs("div",{style:{display:"flex",gap:"15px",justifyContent:"center"},children:[r.jsx(le,{to:`/order/${W}`,className:"btn btn-primary",style:{padding:"12px 25px"},children:"Track Order"}),r.jsx(le,{to:"/",className:"btn btn-secondary",style:{padding:"12px 25px"},children:"Continue Shopping"})]})]}):e.length===0?r.jsx("div",{className:"container",children:"Your cart is empty."}):r.jsxs("div",{style:{maxWidth:"900px",margin:"40px auto",background:"var(--surface)",padding:"10px 30px 40px",borderRadius:"8px",boxShadow:"0 2px 10px rgba(0,0,0,0.05)"},children:[r.jsx("h2",{style:{marginBottom:"30px",borderBottom:"1px solid #eee",paddingBottom:"20px",fontSize:"24px"},children:"Checkout"}),A.general&&r.jsx("div",{style:{padding:"15px",background:"#fee2e2",color:"#dc2626",borderRadius:"8px",marginBottom:"20px"},children:A.general}),r.jsxs("div",{className:"responsive-grid-checkout",children:[r.jsxs("div",{children:[r.jsx("h3",{style:{fontSize:"18px",marginBottom:"20px",color:"var(--text-main)"},children:"1. Shipping Address"}),r.jsxs("div",{className:"card",style:{padding:"20px",border:A.address?"1px solid #dc2626":"none",boxShadow:"none",background:"var(--surface-hover)"},children:[r.jsx("textarea",{value:l,onChange:m=>{d(m.target.value),A.address&&R(p=>({...p,address:null}))},rows:"4",placeholder:"Enter your full shipping address...",style:{width:"100%",padding:"15px",border:"1px solid var(--border)",borderRadius:"8px",resize:"vertical",fontSize:"14px",background:"var(--surface)",color:"var(--text-main)"}}),A.address&&r.jsx("div",{style:{color:"#dc2626",fontSize:"12px",marginTop:"5px"},children:A.address}),r.jsx("p",{style:{fontSize:"12px",color:"var(--text-secondary)",marginTop:"10px"},children:"* We pre-filled this from your profile if available. You can change it for this order."})]}),r.jsxs("div",{style:{marginTop:"30px"},children:[r.jsx("h3",{style:{fontSize:"18px",marginBottom:"20px",color:"var(--text-main)"},children:"2. Payment Method"}),r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"15px"},children:[r.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"15px",padding:"18px",border:v==="Card"?"2px solid var(--primary)":"1px solid var(--border)",borderRadius:"12px",cursor:"pointer",background:v==="Card"?"var(--surface-hover)":"var(--surface)",transition:"all 0.2s"},children:[r.jsx("input",{type:"radio",name:"payment",checked:v==="Card",onChange:()=>O("Card"),style:{accentColor:"var(--primary)",width:"20px",height:"20px"}}),r.jsxs("div",{children:[r.jsx("div",{style:{fontWeight:"600",color:"var(--text-main)"},children:"Credit/Debit Card"}),r.jsx("div",{style:{fontSize:"12px",color:"var(--text-secondary)"},children:"Visa, Mastercard, Amex"})]}),r.jsx("span",{style:{marginLeft:"auto",fontSize:"20px"},children:"ðŸ’³"})]}),r.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"15px",padding:"18px",border:v==="UPI"?"2px solid var(--primary)":"1px solid var(--border)",borderRadius:"12px",cursor:"pointer",background:v==="UPI"?"var(--surface-hover)":"var(--surface)",transition:"all 0.2s"},children:[r.jsx("input",{type:"radio",name:"payment",checked:v==="UPI",onChange:()=>O("UPI"),style:{accentColor:"var(--primary)",width:"20px",height:"20px"}}),r.jsxs("div",{children:[r.jsx("div",{style:{fontWeight:"600",color:"var(--text-main)"},children:"UPI / GPay / PhonePe"}),r.jsx("div",{style:{fontSize:"12px",color:"var(--text-secondary)"},children:"Instant payment"})]}),r.jsx("span",{style:{marginLeft:"auto",fontSize:"20px"},children:"ðŸ“±"})]}),r.jsxs("label",{style:{display:"flex",alignItems:"center",gap:"15px",padding:"18px",border:v==="COD"?"2px solid var(--primary)":"1px solid var(--border)",borderRadius:"12px",cursor:"pointer",background:v==="COD"?"var(--surface-hover)":"var(--surface)",transition:"all 0.2s"},children:[r.jsx("input",{type:"radio",name:"payment",checked:v==="COD",onChange:()=>O("COD"),style:{accentColor:"var(--primary)",width:"20px",height:"20px"}}),r.jsxs("div",{children:[r.jsx("div",{style:{fontWeight:"600",color:"var(--text-main)"},children:"Cash on Delivery"}),r.jsx("div",{style:{fontSize:"12px",color:"var(--text-secondary)"},children:"Pay when it arrives"})]}),r.jsx("span",{style:{marginLeft:"auto",fontSize:"20px"},children:"ðŸ’µ"})]})]})]})]}),r.jsx("div",{children:r.jsxs("div",{style:{position:"sticky",top:"100px",background:"var(--surface-hover)",padding:"25px",borderRadius:"16px",border:"1px solid var(--border)"},children:[r.jsx("h3",{style:{fontSize:"18px",marginBottom:"20px"},children:"Order Summary"}),r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"15px",fontSize:"14px",color:"var(--text-secondary)"},children:[r.jsxs("span",{children:["Price (",e.length," items)"]}),r.jsxs("span",{children:["$",t.toFixed(2)]})]}),x>0&&r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"15px",color:"var(--success)",fontWeight:"500"},children:[r.jsx("span",{children:"Discount Coupon"}),r.jsxs("span",{children:["-$",x.toFixed(2)]})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"15px",fontSize:"14px",color:"var(--text-secondary)"},children:[r.jsx("span",{children:"Delivery Charges"}),r.jsx("span",{style:{color:"var(--success)"},children:"FREE"})]}),r.jsx("div",{style:{borderTop:"2px dashed var(--border)",margin:"20px 0"}}),r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"25px",fontWeight:"800",fontSize:"20px",color:"var(--text-main)"},children:[r.jsx("span",{children:"Total Payable"}),r.jsxs("span",{children:["$",z.toFixed(2)]})]}),r.jsxs("div",{style:{display:"flex",gap:"10px",marginBottom:"20px",flexDirection:"column"},children:[r.jsxs("div",{style:{display:"flex",gap:"10"},children:[r.jsx("input",{type:"text",placeholder:"Enter Promo Code",value:s,onChange:m=>u(m.target.value.toUpperCase()),style:{flex:1,padding:"12px",border:"1px solid #cbd5e1",borderRadius:"8px",background:"var(--surface)",color:"var(--text-main)"}}),r.jsx("button",{onClick:F,className:"btn",style:{padding:"10px 20px",background:"var(--primary)",color:"white",borderRadius:"8px"},children:"Apply"})]}),r.jsx("button",{onClick:I,style:{background:"transparent",border:"1px dashed var(--accent)",color:"var(--accent)",padding:"8px",borderRadius:"8px",fontSize:"12px",cursor:"pointer",fontWeight:"600"},children:"âœ¨ Auto-Apply Best Coupon"}),A.coupon&&r.jsx("div",{style:{color:"#dc2626",fontSize:"12px"},children:A.coupon})]}),i>0&&r.jsxs("div",{style:{marginBottom:"25px",padding:"15px",background:"#f0fdf4",border:"1px solid #bbf7d0",borderRadius:"12px"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"10px",fontWeight:"600",color:"#15803d"},children:[r.jsx("span",{children:"Redeem TechCoins"}),r.jsxs("span",{children:[i," Available"]})]}),r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[r.jsx("input",{type:"range",min:"0",max:Math.min(i,Math.ceil(t*10)),step:"10",value:c,onChange:m=>U(parseInt(m.target.value)),style:{flex:1,accentColor:"#10b981"}}),r.jsxs("span",{style:{minWidth:"60px",textAlign:"right",fontWeight:"bold"},children:[c," pts"]})]}),r.jsxs("div",{style:{fontSize:"12px",color:"#166534",marginTop:"5px",display:"flex",justifyContent:"space-between"},children:[r.jsx("span",{children:"Rate: 10 pts = $1.00"}),r.jsxs("span",{children:["Save: $",(c/10).toFixed(2)]})]})]}),v==="COD"&&r.jsxs("div",{style:{marginBottom:"20px",padding:"15px",background:"var(--surface)",border:"1px solid var(--border)",borderRadius:"12px"},children:[r.jsx("label",{style:{display:"block",marginBottom:"10px",fontWeight:"600",fontSize:"13px"},children:"Verify Order (COD Security)"}),r.jsxs("div",{style:{display:"flex",gap:"15px",alignItems:"center",marginBottom:"10px"},children:[r.jsx("div",{style:{padding:"8px 20px",background:"#334155",color:"white",fontWeight:"bold",letterSpacing:"4px",borderRadius:"6px",fontSize:"18px",userSelect:"none"},children:J}),r.jsx("button",{onClick:K,style:{background:"none",border:"none",fontSize:"20px",cursor:"pointer",color:"var(--accent)"},title:"Refresh Code",children:"â†»"})]}),r.jsx("input",{type:"text",placeholder:"Enter Code Here",value:Y,onChange:m=>{ne(m.target.value.toUpperCase()),H(!1)},style:{padding:"10px",borderRadius:"8px",border:G?"1px solid var(--error)":"1px solid var(--border)",width:"100%",fontSize:"14px"}}),G&&r.jsx("div",{style:{color:"var(--error)",fontSize:"12px",marginTop:"5px"},children:"Incorrect code. Please try again."})]}),r.jsx("button",{onClick:C,className:"btn btn-primary",style:{width:"100%",padding:"16px",fontSize:"16px",borderRadius:"12px",boxShadow:"0 4px 14px rgba(37, 99, 235, 0.4)"},children:v==="COD"?`Place Order ($${z})`:`Pay $${z}`}),r.jsx("div",{style:{marginTop:"15px",textAlign:"center",fontSize:"12px",color:"#94a3b8"},children:"Safe and Secure Payments. 100% Authentic Products."})]})})]}),r.jsx(St,{isOpen:_,onClose:()=>N(!1),onConfirm:$,total:z,method:v})]}):r.jsx("div",{className:"container",children:"Please login to checkout."})};export{Et as default};
