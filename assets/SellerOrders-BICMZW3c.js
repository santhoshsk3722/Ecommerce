import{u as j,a as S,r as x,j as e,m as k}from"./index-CZ-q80kR.js";import{s as C}from"./emailService-Cs8ouLn9.js";import"./index-DtVQIX_c.js";const w=()=>{const{user:a}=j(),{showToast:h}=S(),[o,u]=x.useState([]),[m,v]=x.useState(!0);x.useEffect(()=>{a&&a.role==="seller"&&fetch(`https://techorbit-api.onrender.com/api/orders/seller/${a.id}`).then(t=>t.json()).then(t=>{t.message==="success"&&u(t.data),v(!1)})},[a]);const y=(r,t)=>{fetch(`https://techorbit-api.onrender.com/api/orders/${r}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:t})}).then(c=>c.json()).then(c=>{c.message==="updated"&&(h(`Order status updated to ${t}`,"success"),u(o.map(i=>i.id===r?{...i,status:t}:i)))})},[s,l]=x.useState({show:!1,orderId:null,trackingId:"",courier:""}),b=r=>{l({show:!0,orderId:r,trackingId:"",courier:""})},g=()=>{l({show:!1,orderId:null,trackingId:"",courier:""})},f=()=>{const{orderId:r,trackingId:t,courier:n}=s;if(!t||!n){h("Please enter both Tracking ID and Courier Name","error");return}fetch(`https://techorbit-api.onrender.com/api/orders/${r}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({tracking_id:t,courier_name:n,status:"Shipped"})}).then(i=>i.json()).then(i=>{if(i.message==="updated"){h("Tracking info added & marked Shipped","success");const p=o.find(d=>d.id===r);p&&p.customer_email&&C(r,p.customer_name,p.customer_email,t,n),u(o.map(d=>d.id===r?{...d,tracking_id:t,courier_name:n,status:"Shipped"}:d)),g()}})};return m?e.jsx("div",{className:"container",children:"Loading..."}):!a||a.role!=="seller"?e.jsx("div",{className:"container",children:"Access Denied"}):e.jsxs("div",{className:"container",style:{paddingBottom:"50px",position:"relative"},children:[e.jsx("h2",{style:{marginBottom:"30px",color:"var(--text-main)"},children:"Manage Orders"}),o.length===0?e.jsx("div",{style:{color:"var(--text-secondary)"},children:"No orders found needing your products."}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"20px"},children:o.map(r=>e.jsxs("div",{style:{background:"var(--surface)",border:"1px solid var(--border)",borderRadius:"8px",padding:"20px",boxShadow:"var(--shadow-sm)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"15px",borderBottom:"1px solid var(--border)",paddingBottom:"10px"},children:[e.jsxs("div",{children:[e.jsxs("strong",{style:{color:"var(--text-main)"},children:["Order #",r.id]}),e.jsx("span",{style:{marginLeft:"10px",color:"var(--text-secondary)",fontSize:"14px"},children:new Date(r.date).toLocaleDateString()})]}),e.jsx("div",{children:e.jsx("span",{style:{padding:"5px 10px",borderRadius:"20px",fontSize:"12px",fontWeight:"bold",background:r.status==="Delivered"?"rgba(56, 161, 105, 0.1)":r.status==="Shipped"?"rgba(49, 130, 206, 0.1)":"rgba(229, 62, 62, 0.1)",color:r.status==="Delivered"?"var(--success)":r.status==="Shipped"?"#3182ce":"var(--error)"},children:r.status})})]}),e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsx("h4",{style:{fontSize:"14px",marginBottom:"10px",color:"var(--text-secondary)"},children:"Items to Ship:"}),r.items.map(t=>e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"15px",marginBottom:"10px"},children:[e.jsx("img",{src:t.image,alt:t.title,style:{width:"40px",height:"40px",objectFit:"contain",background:"var(--surface)",borderRadius:"4px",border:"1px solid var(--border)"}}),e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontSize:"14px",fontWeight:"500",color:"var(--text-main)"},children:t.title}),e.jsxs("div",{style:{fontSize:"13px",color:"var(--text-secondary)"},children:["Qty: ",t.quantity," | Price: $",t.price]})]})]},t.product_id))]}),e.jsxs("div",{style:{marginBottom:"15px",padding:"15px",background:"var(--surface-hover)",borderRadius:"8px"},children:[e.jsx("h4",{style:{fontSize:"14px",marginBottom:"8px",color:"var(--text-main)"},children:"Shipping Details"}),e.jsxs("div",{style:{fontSize:"14px",color:"var(--text-secondary)"},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"To:"})," ",r.customer_name," (",r.customer_email,")"]}),e.jsxs("div",{style:{marginTop:"5px"},children:[e.jsx("strong",{children:"Address:"})," ",r.shipping_address||"No address provided"]})]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"flex-end",gap:"10px",marginTop:"10px",borderTop:"1px solid var(--border)",paddingTop:"15px"},children:[r.status==="Processing"&&e.jsx("button",{onClick:()=>b(r.id),className:"btn btn-primary",style:{fontSize:"13px",padding:"8px 15px"},children:"Ship Order"}),r.status==="Shipped"&&e.jsx("button",{onClick:()=>y(r.id,"Delivered"),className:"btn btn-success",style:{fontSize:"13px",padding:"8px 15px",background:"var(--success)",color:"white",border:"none",borderRadius:"4px"},children:"Mark Delivered"}),e.jsx("div",{style:{fontSize:"13px",color:"var(--text-secondary)",alignSelf:"center"},children:r.tracking_id&&`Tracking: ${r.courier_name} - ${r.tracking_id}`})]})]},r.id))}),s.show&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsxs(k.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},style:{background:"var(--surface)",padding:"30px",borderRadius:"12px",width:"400px",boxShadow:"var(--shadow-lg)",border:"1px solid var(--border)"},children:[e.jsxs("h3",{style:{marginBottom:"20px",color:"var(--text-main)"},children:["Ship Order #",s.orderId]}),e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"8px",color:"var(--text-secondary)"},children:"Courier Name"}),e.jsx("input",{autoFocus:!0,placeholder:"e.g. FedEx, DHL, BlueDart",value:s.courier,onChange:r=>l({...s,courier:r.target.value}),style:{width:"100%",padding:"10px",borderRadius:"6px",border:"1px solid var(--border)",background:"var(--surface-hover)",color:"var(--text-main)"}})]}),e.jsxs("div",{style:{marginBottom:"25px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"8px",color:"var(--text-secondary)"},children:"Tracking ID"}),e.jsx("input",{placeholder:"e.g. TRK123456789",value:s.trackingId,onChange:r=>l({...s,trackingId:r.target.value}),style:{width:"100%",padding:"10px",borderRadius:"6px",border:"1px solid var(--border)",background:"var(--surface-hover)",color:"var(--text-main)"}})]}),e.jsxs("div",{style:{display:"flex",gap:"10px"},children:[e.jsx("button",{onClick:f,className:"btn btn-primary",style:{flex:1,padding:"10px"},children:"Confirm Shipment"}),e.jsx("button",{onClick:g,className:"btn btn-secondary",style:{flex:1,padding:"10px"},children:"Cancel"})]})]})})]})};export{w as default};
