import{u as T,r as l,j as e,m as h,c as C,d as z,e as W,H as B}from"./index-BTphzEob.js";import{P as N}from"./PageTransition-CJO213C5.js";const $=({productId:d})=>{const{user:c}=T(),[n,f]=l.useState([]),[t,w]=l.useState(!0),[m,b]=l.useState(5),[j,y]=l.useState(""),[x,g]=l.useState(!1),[o,v]=l.useState(!1),S=c&&n.some(r=>r.user_id===c.id),s=()=>{const r=n.find(p=>p.user_id===c.id);r&&(b(r.rating),y(r.comment),v(!0))};l.useEffect(()=>{d&&i()},[d]);const i=()=>{fetch(`https://techorbit-api.onrender.com/api/reviews/${d}`).then(p=>p.json()).then(p=>{p.message==="success"&&f(p.data),w(!1)})},u=async r=>{if(r.preventDefault(),!c){alert("Please login to write a review");return}g(!0);const p="https://techorbit-api.onrender.com";try{const k=o?"PUT":"POST",R=await(await fetch(`${p}/api/reviews`,{method:k,headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:c.id,product_id:d,rating:parseInt(m),comment:j})})).json();R.message==="success"?(y(""),v(!1),i()):alert(R.error||"Something went wrong")}catch(k){console.error("Failed to post review",k)}g(!1)},a=n.length?(n.reduce((r,p)=>r+p.rating,0)/n.length).toFixed(1):0;return e.jsxs("div",{style:{marginTop:"50px",paddingTop:"40px",borderTop:"1px solid var(--border)"},children:[e.jsx("h3",{style:{fontSize:"24px",marginBottom:"30px"},children:"Customer Reviews"}),e.jsxs("div",{className:"responsive-grid-reviews",style:{display:"grid",gridTemplateColumns:"1fr 2fr",gap:"40px"},children:[e.jsxs("div",{style:{background:"var(--surface-hover)",padding:"30px",borderRadius:"16px",height:"fit-content"},children:[e.jsxs("div",{style:{fontSize:"48px",fontWeight:"bold",color:"var(--text-main)",lineHeight:1},children:[a,e.jsx("span",{style:{fontSize:"20px",color:"var(--text-secondary)",marginLeft:"10px"},children:"/ 5"})]}),e.jsx("div",{style:{color:"var(--warning)",fontSize:"20px",margin:"10px 0"},children:"â˜…".repeat(Math.round(a))+"â˜†".repeat(5-Math.round(a))}),e.jsxs("p",{style:{color:"var(--text-secondary)"},children:["Based on ",n.length," reviews"]}),c&&!S||o?e.jsxs("form",{onSubmit:u,style:{marginTop:"30px",borderTop:"1px solid var(--border)",paddingTop:"20px"},children:[e.jsx("h4",{style:{marginBottom:"15px"},children:o?"Update your Review":"Write a Review"}),e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"5px",fontSize:"14px"},children:"Rating"}),e.jsx("div",{style:{display:"flex",gap:"5px"},children:[1,2,3,4,5].map(r=>e.jsx("span",{onClick:()=>b(r),style:{cursor:"pointer",fontSize:"24px",color:r<=m?"var(--warning)":"#cbd5e1"},children:"â˜…"},r))})]}),e.jsx("textarea",{value:j,onChange:r=>y(r.target.value),placeholder:"Share your thoughts...",style:{width:"100%",padding:"12px",borderRadius:"8px",border:"1px solid var(--border)",marginBottom:"15px",background:"var(--surface)",color:"var(--text-main)"},rows:"3",required:!0}),e.jsx("button",{type:"submit",disabled:x,className:"btn btn-primary",style:{width:"100%",padding:"10px"},children:x?"Submitting...":o?"Update Review":"Post Review"}),o&&e.jsx("button",{type:"button",onClick:()=>v(!1),style:{width:"100%",marginTop:"10px",padding:"10px",background:"transparent",border:"none",color:"var(--text-secondary)",cursor:"pointer"},children:"Cancel"})]}):S&&!o?e.jsxs("div",{style:{marginTop:"30px",padding:"15px",background:"#ecfdf5",color:"#047857",borderRadius:"8px",textAlign:"center",border:"1px solid #a7f3d0"},children:[e.jsx("div",{children:"âœ… You have already reviewed this product."}),e.jsx("button",{onClick:s,style:{marginTop:"10px",background:"transparent",border:"1px solid #047857",color:"#047857",padding:"5px 15px",borderRadius:"6px",cursor:"pointer",fontSize:"12px",fontWeight:"bold"},children:"Edit Review"})]}):e.jsxs("div",{style:{marginTop:"20px",padding:"15px",background:"var(--surface)",borderRadius:"8px",textAlign:"center"},children:[e.jsx("a",{href:"/#/login",style:{color:"var(--primary)",fontWeight:"bold"},children:"Login"})," to write a review."]})]}),e.jsx("div",{children:t?e.jsx("p",{children:"Loading reviews..."}):n.length===0?e.jsx("div",{style:{padding:"40px",textAlign:"center",background:"var(--surface)",borderRadius:"12px"},children:e.jsx("p",{style:{color:"var(--text-secondary)"},children:"No reviews yet. Be the first!"})}):e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"20px"},children:n.map(r=>e.jsxs(h.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},style:{padding:"20px",background:"var(--surface)",borderRadius:"12px",border:"1px solid var(--border)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"10px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx("div",{style:{width:"32px",height:"32px",borderRadius:"50%",background:"var(--primary-gradient)",color:"white",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:"bold",fontSize:"12px"},children:r.user_name?r.user_name.charAt(0).toUpperCase():"U"}),e.jsx("strong",{children:r.user_name})]}),e.jsx("div",{style:{color:"var(--warning)",fontSize:"14px"},children:"â˜…".repeat(r.rating)+"â˜†".repeat(5-r.rating)})]}),e.jsx("p",{style:{color:"var(--text-secondary)",lineHeight:1.6,margin:"10px 0"},children:r.comment}),e.jsx("div",{style:{fontSize:"12px",color:"var(--text-light)"},children:new Date(r.date).toLocaleDateString()})]},r.id))})})]})]})},O=()=>{const{id:d}=C(),c=z(),{user:n}=T(),{addToCart:f}=W(),[t,w]=l.useState(null),[m,b]=l.useState([]),[j,y]=l.useState(!0),[x,g]=l.useState(!1),[o,v]=l.useState({});l.useEffect(()=>{const s="https://techorbit-api.onrender.com";fetch(`${s}/api/products/${d}`).then(i=>i.json()).then(i=>{if(i.message==="success"){w(i.data);const a=JSON.parse(localStorage.getItem("viewHistory")||"[]").filter(r=>r.id!==i.data.id);a.unshift({id:i.data.id,title:i.data.title,image:i.data.image,price:i.data.price,category:i.data.category}),a.length>10&&a.pop(),localStorage.setItem("viewHistory",JSON.stringify(a)),fetch(`${s}/api/products?category=${i.data.category}&excludeId=${d}&limit=4`).then(r=>r.json()).then(r=>{r.message==="success"&&b(r.data)})}y(!1)})},[d]),l.useEffect(()=>{n&&d&&fetch(`https://techorbit-api.onrender.com/api/wishlist/${n.id}`).then(i=>i.json()).then(i=>{if(i.message==="success"){const u=i.data.some(a=>a.product_id==d||a.id==d);g(u)}}).catch(i=>console.error("Wishlist check failed",i))},[d,n]);const S=async()=>{if(!n){c("/login");return}const s="https://techorbit-api.onrender.com";try{x?(await fetch(`${s}/api/wishlist/remove/${n.id}/${t.id}`,{method:"DELETE"}),g(!1)):(await fetch(`${s}/api/wishlist`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({user_id:n.id,product_id:t.id})}),g(!0))}catch(i){console.error(i)}};return j?e.jsx("div",{className:"container",style:{padding:"50px"},children:"Loading product details..."}):t?e.jsxs(N,{children:[t&&e.jsxs(B,{children:[e.jsxs("title",{children:[t.title," - TechOrbit"]}),e.jsx("meta",{name:"description",content:t.description?.substring(0,160)||`Buy ${t.title} at the best price on TechOrbit.`})]}),e.jsxs("div",{className:"container",children:[e.jsxs("div",{className:"responsive-grid-detail",children:[e.jsx(h.div,{className:"product-detail-image-wrapper",initial:{opacity:0,x:-50},animate:{opacity:1,x:0},transition:{duration:.6},children:e.jsx(h.img,{whileHover:{scale:1.05},transition:{duration:.3},src:t.image,alt:t.title,style:{maxWidth:"100%",maxHeight:"500px",objectFit:"contain"}})}),e.jsxs(h.div,{initial:{opacity:0,x:50},animate:{opacity:1,x:0},transition:{duration:.6,delay:.2},children:[e.jsx("div",{style:{marginBottom:"10px",textTransform:"uppercase",letterSpacing:"1px",color:"var(--accent)",fontWeight:"bold",fontSize:"14px"},children:t.category}),e.jsx("h1",{style:{fontSize:"42px",fontWeight:"800",lineHeight:1.2,marginBottom:"20px"},children:t.title}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"20px",marginBottom:"30px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",background:"var(--success)",color:"white",padding:"4px 12px",borderRadius:"20px",fontWeight:"bold"},children:[t.average_rating?Number(t.average_rating).toFixed(1):"New"," â˜…"]}),e.jsx("span",{style:{color:"var(--text-secondary)"},children:t.review_count?`${t.review_count} Verified Reviews`:"No reviews yet"})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"30px"},children:[e.jsxs("div",{style:{fontSize:"36px",fontWeight:"700",color:"var(--primary)",display:"flex",alignItems:"center",gap:"15px"},children:["$",t.price,e.jsxs("span",{style:{fontSize:"20px",color:"var(--text-light)",textDecoration:"line-through",fontWeight:"normal"},children:["$",(t.price*1.2).toFixed(2)]})]}),e.jsx("button",{onClick:S,style:{background:"none",border:"none",cursor:"pointer",fontSize:"28px",color:x?"var(--error)":"var(--text-light)",transition:"transform 0.2s",padding:"10px"},title:x?"Remove from Wishlist":"Add to Wishlist",children:x?"â¤ï¸":"ðŸ¤"})]}),e.jsxs("div",{style:{background:"var(--surface-hover)",padding:"20px",borderRadius:"12px",borderLeft:"4px solid var(--accent)",marginBottom:"30px"},children:[e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"10px",marginBottom:"10px",color:"var(--accent)",fontWeight:"800"},children:e.jsx("span",{children:"ðŸ¤– AI Verdict"})}),e.jsxs("p",{style:{fontSize:"14px",color:"var(--text-secondary)",fontStyle:"italic",margin:0},children:['"Customers love the ',e.jsx("strong",{children:"build quality"})," and ",e.jsx("strong",{children:"value for money"}),". Some verified users mentioned the ",e.jsx("strong",{children:"shipping"})," was faster than expected. Highly recommended for ",e.jsx("strong",{children:t.category}),' enthusiasts."']})]}),e.jsx("p",{style:{fontSize:"18px",color:"var(--text-secondary)",lineHeight:1.8,marginBottom:"40px"},children:t.description}),e.jsxs("div",{style:{display:"flex",gap:"20px",flexDirection:"column"},children:[t.variants&&(()=>{let s=[];try{s=typeof t.variants=="string"?JSON.parse(t.variants):t.variants}catch{s=[]}return!s||s.length===0?null:e.jsx("div",{style:{marginBottom:"25px",padding:"15px",background:"var(--surface)",borderRadius:"8px",border:"1px solid var(--border)"},children:s.map((i,u)=>e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:"8px",fontSize:"14px"},children:[i.name,":"]}),e.jsx("div",{style:{display:"flex",gap:"10px",flexWrap:"wrap"},children:i.options.map(a=>e.jsx("button",{onClick:()=>v(r=>({...r,[i.name]:a})),style:{padding:"6px 14px",borderRadius:"20px",border:o[i.name]===a?"2px solid var(--primary)":"1px solid var(--border)",background:o[i.name]===a?"var(--primary)":"var(--surface-hover)",color:o[i.name]===a?"white":"var(--text-main)",cursor:"pointer",fontSize:"13px",transition:"all 0.2s"},children:a},a))})]},u))})})(),n&&(n.role==="seller"||n.role==="admin")?e.jsxs("div",{style:{padding:"15px",background:"var(--surface-hover)",color:"var(--text-secondary)",borderRadius:"8px",textAlign:"center",border:"1px solid var(--border)",fontSize:"14px"},children:["ðŸ”’ Signed in as ",n.role.charAt(0).toUpperCase()+n.role.slice(1),". ",e.jsx("br",{}),"Please ",e.jsx("span",{style:{color:"var(--primary)",cursor:"pointer",fontWeight:"bold"},onClick:()=>c("/login"),children:"login as a customer"})," to purchase."]}):t.stock!==void 0&&t.stock<=0?e.jsx("div",{style:{padding:"15px",background:"rgba(239, 68, 68, 0.1)",color:"var(--error)",borderRadius:"8px",textAlign:"center",fontWeight:"bold",border:"1px solid rgba(239, 68, 68, 0.3)"},children:"ðŸš« Out of Stock"}):e.jsxs("div",{style:{display:"flex",gap:"20px"},children:[e.jsx(h.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>{let s=0;try{const i=typeof t.variants=="string"?JSON.parse(t.variants):t.variants;i&&(s=i.length)}catch{}if(s>0&&Object.keys(o).length<s){alert("Please select all options (Size, Color, etc.)");return}f({...t,selectedVariants:o})},className:"btn btn-secondary",style:{flex:1,padding:"20px",fontSize:"18px"},children:"Add to Cart"}),e.jsx(h.button,{whileHover:{scale:1.02},whileTap:{scale:.98},onClick:()=>{let s=0;try{const i=typeof t.variants=="string"?JSON.parse(t.variants):t.variants;i&&(s=i.length)}catch{}if(s>0&&Object.keys(o).length<s){alert("Please select all options (Size, Color, etc.)");return}f({...t,selectedVariants:o}),c("/cart")},className:"btn btn-primary",style:{flex:1,padding:"20px",fontSize:"18px"},children:"Buy Now"})]}),t.stock!==void 0&&t.stock>0&&t.stock<10&&e.jsxs("div",{style:{color:"var(--error)",fontSize:"14px",fontWeight:"600",textAlign:"center"},children:["ðŸ”¥ Hurry! Only ",t.stock," left in stock."]})]}),e.jsxs("div",{style:{display:"flex",gap:"30px",marginTop:"40px",borderTop:"1px solid var(--border)",paddingTop:"30px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",color:"var(--text-secondary)"},children:[e.jsx("span",{children:"ðŸšš"})," Free Shipping"]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",color:"var(--text-secondary)"},children:[e.jsx("span",{children:"ðŸ›¡ï¸"})," 2 Year Warranty"]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px",color:"var(--text-secondary)"},children:[e.jsx("span",{children:"â†©ï¸"})," 30 Day Returns"]})]})]})]}),e.jsx($,{productId:t.id}),m.length>0&&e.jsxs("div",{style:{marginTop:"80px",borderTop:"1px solid var(--border)",paddingTop:"40px"},children:[e.jsx("h2",{style:{marginBottom:"30px"},children:"You might also like"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:"30px"},children:m.map(s=>e.jsx(h.div,{whileHover:{y:-5},onClick:()=>c(`/product/${s.id}`),style:{cursor:"pointer"},children:e.jsxs("div",{style:{background:"var(--surface)",borderRadius:"8px",padding:"20px",textAlign:"center",boxShadow:"0 2px 8px rgba(0,0,0,0.05)",height:"100%"},children:[e.jsx("img",{src:s.image,alt:s.title,style:{width:"100%",height:"150px",objectFit:"contain",marginBottom:"15px"}}),e.jsx("h4",{style:{fontSize:"16px",margin:"0 0 10px 0",height:"40px",overflow:"hidden"},children:s.title}),e.jsxs("div",{style:{color:"var(--primary)",fontWeight:"bold"},children:["$",s.price]})]})},s.id))})]})]})]}):e.jsx("div",{className:"container",children:"Product not found"})};export{O as default};
